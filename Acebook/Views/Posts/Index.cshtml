@model acebook.Models.User
@using acebook.Models
@{
    var errorMessage = TempData["ErrorMessage"];
}

@if (errorMessage != null)
{
    <div class="alert alert-danger text-center">
        @errorMessage
    </div>
}

<div class="profile-buttons">
    @if (Context.Session.GetString("Username") == ViewBag.ProfileUserName)
    {
        <a href="@Url.Action("Profile", "Users", new { username = ViewBag.ProfileUserName })" class="btn btn-primary">Profile</a>
    }
    <form action="@Url.Action("Logout", "Sessions")" method="post" style="display:inline;">
        <button type="submit" class="btn btn-secondary">Logout</button>
    </form>
</div>

<div class="post-form">
    <img src="@(string.IsNullOrEmpty(ViewBag.CurrentUser?.profilePicture) ? "/images/default-profile.png" : ViewBag.CurrentUser.profilePicture)" 
        alt="User Profile Picture" class="profile-pic" />

    <form action="/posts" method="post" enctype="multipart/form-data">
        <!-- Hidden field to store the ReturnUrl -->
        <input type="hidden" name="ReturnUrl" value="@Context.Request.Path.Value" />
        
        <div class="input-container">
            <input type="text" id="PostText" name="PostText" placeholder="What's on your mind?" class="post-input" />
        </div>

        <div class="image-upload">
            <label for="PostImageUrl"></label>
            <input type="text" id="PostImageUrl" name="PostImageUrl" placeholder="Enter image URL" class="image-input" />
            <span>or</span>
            <input type="file" id="PostImageFile" name="PostImageFile" class="file-input" />
            <button type="submit" id="submit" class="post-btn">Post</button>
        </div>
    </form>
</div>

@{
    Layout = "~/Views/Shared/_Layout.cshtml"; // If you're using a shared layout
}

<style>
    .post-link, .post-link:visited, .post-link:active, .post-link:hover {
        all: unset !important;
        cursor: pointer !important;
        display: block !important;
    }
</style>

@foreach (Post post in ViewBag.Posts)
{
    <a href="@Url.Action("GetPost", "Posts", new { postId = post.Id })" class="post-link">
        <div class="post-container">
            <div class="user-info">
                <img src="@(string.IsNullOrEmpty(post.User?.profilePicture) ? "/images/default-profile.png" : post.User.profilePicture)" 
                    alt="User Profile Picture" class="profile-pic" />
                <p class="user-name">@post.User?.Name</p>
            </div>

            <div class="post-content">
                <p class="post-text">@post.PostText</p>

                @if (!string.IsNullOrEmpty(post.PostImage))
                {
                    <img src="@post.PostImage" alt="Post Image" class="post-image" />
                }

                <p class="post-meta-date">Posted on: @post.CreatedAt.ToString("dd MMM yyyy, HH:mm")</p>
            </div>

            <div class="reactions">
                <div class="like-count">
                    <span>üëç 0</span> 
                </div>
                <div class="comment-count">
                    <span>üí¨ 0</span> 
                </div>
            </div>
        </div>
    </a>
}



